<div class="container-fluid">
  <div class="panel panel-default">
    <div class="panel-heading">
      Status
    </div>
    <div class="panel-body">
      <table *ngIf="selectedJob !== null" class="table">
        <tbody class="job-status">
          <tr *ngFor="let current of selectedJob.status">
            <td>
              <div class="row">
                <div class="col-md-2"><h4>{{current.status}}</h4></div>
                <div class="col-md-4"><h5>{{current.created_date|date:'medium'}}</h5></div>
              </div>
              <br>
              <div *ngFor="let message of current.messages" class="row">
                <div class="col-md-2 col-md-offset-1">{{message.created_date|date:'medium'}}</div>
                <div class="col-md-1">{{message.percent}} %</div>
                <div class="col-md-8">{{message.message}}</div>
              </div>
              <ng-container *ngIf="current?.output; else exception">
                <ng-container *ngIf="current?.output.length > 1; else singleOutput">
                  <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-11">
                      <div *ngFor="let x of current.output">
                        <a href="{{x.uri}}.html" target="_blank">{{x.id}}</a>
                      </div>
                    </div>
                  </div>
                </ng-container>
                <ng-template #singleOutput>
                  <ng-container *ngIf="current.output.uri != undefined; else rawOutput">
                    <div class="row">
                      <div class="col-md-1"></div>
                      <div class="col-md-11"><a href="{{current.output.uri}}.html" target="_blank">{{current.output.id}}</a></div>
                    </div>
                  </ng-container>
                </ng-template>
                <ng-template #rawOutput>
                  <ng-container>
                    <div class="row">
                      <div class="col-md-1"></div>
                      <div class="col-md-11"><pre>{{current.output | json}}</pre></div>
                    </div>
                  </ng-container>
                </ng-template>
              </ng-container>
              <ng-template #exception>
                <ng-container *ngIf="current.exception != null">
                  <div class="row">
                    <div class="col-md-1"></div>
                    <div class="col-md-11"><pre>{{current.exceptionParsed()}}</pre></div>
                  </div>
                </ng-container>
              </ng-template>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div>
      <table class="table">
        <thead>
          <tr>
            <th (click)="sort('accepted_on')">
              <a>
                Accepted
                <ng-container *ngIf="sortKey === 'accepted_on'">
                <i *ngIf="sortDir === 1" class="fa fa-sort-asc" aria-hidden="true"></i>
                <i *ngIf="sortDir === -1" class="fa fa-sort-desc" aria-hidden="true"></i>
                </ng-container>
              </a>
            </th>
            <th (click)="sort('elapsed')">
              <a>
                Elapsed
                <ng-container *ngIf="sortKey === 'elapsed'">
                <i *ngIf="sortDir === 1" class="fa fa-sort-asc" aria-hidden="true"></i>
                <i *ngIf="sortDir === -1" class="fa fa-sort-desc" aria-hidden="true"></i>
                </ng-container>
              </a>
            </th>
            <th>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr class="job" [class.selected]="selectedJob === item" *ngFor="let item of jobs" (click)="selectJob(item)">
            <td *ngIf="item.accepted_on !== 'Unknown'; else plainAcceptedOn">{{ item.accepted_on|date:'medium' }}</td>
            <ng-template #plainAcceptedOn>
              <td>{{ item.accepted_on }}</td>
            </ng-template>
            <td>{{ item.elapsed }}</td>
            <td>
              <button type="button" class="close" aria-label="Close" (click)="deleteJob(item)">
                <span aria-hidden="true">&times;</span>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
      <nav aria-label="Page navigation">
        <ul class="pager">
          <li [class.disabled]="userService.previous === null" (click)="previousPage()"><a>Previous</a></li>
          <li [class.disabled]="userService.next === null" (click)="nextPage()"><a>Next</a></li>
        </ul>
      </nav>
    </div>
  </div>
</div>
